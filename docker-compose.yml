version: '2.1'

# Run: docker-compose --project-name=ocean up

services:
  mongodb:
    image: mongo:3.6
    ports:
    - "27017:27017"
    command: mongod
    networks:
    - backend

  keeper-contracts:
    image: oceanprotocol/keeper-contracts:${OCEAN_VERSION:-stable}
    ports:
    - 8545:8545
    networks:
    - backend
    environment:
      LOCAL_CONTRACTS: "true"
      DEPLOY_CONTRACTS: ${DEPLOY_CONTRACTS}
      DATABASE_PATH: "/ganache-db"
      REUSE_DATABASE: ${REUSE_DATABASE}
      NETWORK_NAME: ${KEEPER_NETWORK_NAME}
    volumes:
    - ${ARTIFACTS_FOLDER}:/keeper-contracts/artifacts/
    - ${GANACHE_DATABASE_PATH}/ganache-db:/ganache-db

  aquarius:
    image: oceanprotocol/aquarius:${OCEAN_VERSION:-stable}
    ports:
    - 5000:5000
    networks:
    - backend
    depends_on:
    - keeper-contracts
    environment:
      KEEPER_URL: http://keeper-contracts:8545
      DB_HOSTNAME: mongodb
      LOCAL_CONTRACTS: "true"
    volumes:
    - ${ARTIFACTS_FOLDER}:/usr/local/keeper-contracts/:ro

  brizo:
    image: oceanprotocol/brizo:${OCEAN_VERSION:-stable}
    ports:
    - 8030:8030
    networks:
    - backend
    depends_on:
    - keeper-contracts
    environment:
      KEEPER_URL: http://keeper-contracts:8545
      LOCAL_CONTRACTS: "true"
      KEEPER_NETWORK_NAME: ${KEEPER_NETWORK_NAME}
      AQUARIUS_URL: http://aquarius:5000
      AZURE_ACCOUNT_NAME: "${AZURE_ACCOUNT_NAME}"
      AZURE_ACCOUNT_KEY: "${AZURE_ACCOUNT_KEY}"
      AZURE_RESOURCE_GROUP: "${AZURE_RESOURCE_GROUP}"
      AZURE_LOCATION: "${AZURE_LOCATION}"
      AZURE_CLIENT_ID: "${AZURE_CLIENT_ID}"
      AZURE_CLIENT_SECRET: "${AZURE_CLIENT_SECRET}"
      AZURE_TENANT_ID: "${AZURE_TENANT_ID}"
      AZURE_SUBSCRIPTION_ID: "${AZURE_SUBSCRIPTION_ID}"
    volumes:
    - ${ARTIFACTS_FOLDER}:/usr/local/keeper-contracts/:ro

  pleuston:
    image: oceanprotocol/pleuston:${OCEAN_VERSION:-stable}
    ports:
    - 3000:3000
    depends_on:
    - keeper-contracts
    environment:
      KEEPER_HOST: keeper-contracts
      OCEAN_HOST: aquarius
      LOCAL_CONTRACTS: 'true'
    volumes:
    - ${ARTIFACTS_FOLDER}:/pleuston/node_modules/@oceanprotocol/keeper-contracts/artifacts/:ro

networks:
  backend:


